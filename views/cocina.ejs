<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocina</title>
    <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/vendor/bootstrap-icons/bootstrap-icons.css">
    <style>
        html, body { height: 100%; }
        body { min-height: 100vh; display: flex; flex-direction: column; }
        body{background-color:#f8f9fa}
        /* UI moderna cocina */
        .kpi-badge{font-weight:600}
        .cocina-toolbar{
          background: #ffffff;
          border: 1px solid rgba(0,0,0,.06);
          box-shadow: 0 .25rem .75rem rgba(0,0,0,.04);
          border-radius: .75rem;
          padding: .75rem;
        }
        .cocina-card{
          border: 1px solid rgba(0,0,0,.06);
          border-radius: .9rem;
          box-shadow: 0 .4rem 1rem rgba(0,0,0,.05);
        }
        .cocina-card .product-name{font-weight:700; font-size:1.05rem; line-height:1.25}
        .cocina-card .meta{color:#6c757d; font-size:.85rem}
        .cocina-note{
          background:#fff5f5;
          border:1px solid rgba(220,53,69,.25);
          color:#b02a37;
          border-radius:.6rem;
          padding:.4rem .6rem;
          font-weight:600;
          font-size:.9rem;
        }
        .empty-state{
          border: 1px dashed rgba(0,0,0,.15);
          border-radius: .9rem;
          background: #fff;
          padding: 1rem;
          color:#6c757d;
          text-align:center;
        }
    </style>
</head>
<body>
    <%- include('partials/navbar') %>

    <main class="flex-grow-1">
    <div class="container">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
          <div>
            <h4 class="mb-0"><i class="bi bi-egg-fried me-2"></i>Cocina</h4>
            <div class="text-muted small">Gestiona el estado de preparación de forma rápida y clara.</div>
          </div>
          <div class="d-flex align-items-center gap-2">
            <button id="btnRefreshCocina" class="btn btn-outline-secondary btn-sm" type="button">
              <i class="bi bi-arrow-clockwise me-1"></i>Actualizar
            </button>
            <div class="form-check form-switch m-0">
              <input class="form-check-input" type="checkbox" role="switch" id="toggleAutoRefresh" checked>
              <label class="form-check-label small" for="toggleAutoRefresh">Auto</label>
            </div>
          </div>
        </div>

        <div class="cocina-toolbar mb-3">
          <div class="row g-2 align-items-center">
            <div class="col-12 col-md-6">
              <div class="input-group">
                <span class="input-group-text"><i class="bi bi-search"></i></span>
                <input id="buscarCocina" class="form-control" placeholder="Buscar por mesa, producto o nota...">
              </div>
            </div>
            <div class="col-12 col-md-6 d-flex justify-content-md-end gap-2 flex-wrap">
              <span class="badge text-bg-primary kpi-badge">Enviados: <span id="countEnviados">0</span></span>
              <span class="badge text-bg-warning kpi-badge">Preparando: <span id="countPreparando">0</span></span>
              <span class="badge text-bg-success kpi-badge">Listos: <span id="countListos">0</span></span>
            </div>
          </div>
          <!-- Filtros de Entregados (por defecto hoy) -->
          <!-- Relacionado con: public/js/cocina.js (GET /api/cocina/entregados?desde&hasta) -->
          <div class="row g-2 align-items-end mt-2">
            <div class="col-12 col-md-3">
              <label class="form-label small mb-1">Desde</label>
              <input type="date" id="entDesde" class="form-control form-control-sm">
            </div>
            <div class="col-12 col-md-3">
              <label class="form-label small mb-1">Hasta</label>
              <input type="date" id="entHasta" class="form-control form-control-sm">
            </div>
            <div class="col-12 col-md-3">
              <button id="btnFiltrarEntregados" class="btn btn-outline-secondary btn-sm w-100" type="button">
                <i class="bi bi-funnel me-1"></i>Filtrar entregados
              </button>
            </div>
            <div class="col-12 col-md-3 small text-muted">
              Predeterminado: <strong>hoy</strong>
            </div>
          </div>
        </div>

        <ul class="nav nav-pills gap-2" id="tabsCocina" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="tabEnviados-tab" data-bs-toggle="tab" data-bs-target="#tabEnviados" type="button" role="tab" aria-controls="tabEnviados" aria-selected="true">
              <i class="bi bi-send me-1"></i>Enviados <span class="badge text-bg-light ms-1" id="pillEnviados">0</span>
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tabPreparando-tab" data-bs-toggle="tab" data-bs-target="#tabPreparando" type="button" role="tab" aria-controls="tabPreparando" aria-selected="false">
              <i class="bi bi-fire me-1"></i>Preparando <span class="badge text-bg-light ms-1" id="pillPreparando">0</span>
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tabListos-tab" data-bs-toggle="tab" data-bs-target="#tabListos" type="button" role="tab" aria-controls="tabListos" aria-selected="false">
              <i class="bi bi-check2-circle me-1"></i>Listos <span class="badge text-bg-light ms-1" id="pillListos">0</span>
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tabEntregados-tab" data-bs-toggle="tab" data-bs-target="#tabEntregados" type="button" role="tab" aria-controls="tabEntregados" aria-selected="false">
              <i class="bi bi-box-seam me-1"></i>Entregados <span class="badge text-bg-light ms-1" id="pillEntregados">0</span>
            </button>
          </li>
          <!-- Pestaña Rechazados: visualizar pedidos/items cancelados (estado='rechazado') -->
          <!-- Relacionado con: routes/cocina.js (GET /api/cocina/rechazados) y public/js/cocina.js -->
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="tabRechazados-tab" data-bs-toggle="tab" data-bs-target="#tabRechazados" type="button" role="tab" aria-controls="tabRechazados" aria-selected="false">
              <i class="bi bi-x-octagon me-1"></i>Rechazados <span class="badge text-bg-light ms-1" id="pillRechazados">0</span>
            </button>
          </li>
        </ul>

        <div class="tab-content pt-3">
          <div class="tab-pane fade show active" id="tabEnviados" role="tabpanel" aria-labelledby="tabEnviados-tab" tabindex="0">
            <div id="listaEnviados" class="vstack gap-2"></div>
            <div id="emptyEnviados" class="empty-state mt-2 d-none">
              <i class="bi bi-inbox me-1"></i>No hay pedidos enviados.
            </div>
          </div>
          <div class="tab-pane fade" id="tabPreparando" role="tabpanel" aria-labelledby="tabPreparando-tab" tabindex="0">
            <div id="listaPreparando" class="vstack gap-2"></div>
            <div id="emptyPreparando" class="empty-state mt-2 d-none">
              <i class="bi bi-inbox me-1"></i>No hay pedidos en preparación.
            </div>
          </div>
          <div class="tab-pane fade" id="tabListos" role="tabpanel" aria-labelledby="tabListos-tab" tabindex="0">
            <div id="listaListos" class="vstack gap-2"></div>
            <div id="emptyListos" class="empty-state mt-2 d-none">
              <i class="bi bi-inbox me-1"></i>No hay pedidos listos para entregar.
            </div>
          </div>
          <div class="tab-pane fade" id="tabEntregados" role="tabpanel" aria-labelledby="tabEntregados-tab" tabindex="0">
            <div id="listaEntregados" class="vstack gap-2"></div>
            <div id="emptyEntregados" class="empty-state mt-2 d-none">
              <i class="bi bi-inbox me-1"></i>No hay pedidos entregados en el rango seleccionado.
            </div>
          </div>
          <div class="tab-pane fade" id="tabRechazados" role="tabpanel" aria-labelledby="tabRechazados-tab" tabindex="0">
            <div id="listaRechazados" class="vstack gap-2"></div>
            <div id="emptyRechazados" class="empty-state mt-2 d-none">
              <i class="bi bi-inbox me-1"></i>No hay pedidos rechazados en el rango seleccionado.
            </div>
          </div>
        </div>
    </div>
    </main>

    <%- include('partials/footer') %>

    <script src="/vendor/jquery/jquery.min.js"></script>
    <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- SweetAlert2 (confirmaciones). Relacionado con: public/js/cocina.js (cancelar item) -->
    <script src="/vendor/sweetalert2/sweetalert2.all.min.js"></script>
    <script>
      // Render inicial (evita “pantalla vacía” mientras carga el fetch)
      window.__COCINA_ITEMS__ = <%- JSON.stringify(items || []) %>;
      // Rol del usuario (para esconder acciones en UI cuando es mesero)
      // Relacionado con: public/js/cocina.js y middleware/auth.js (res.locals.user)
      window.__USER_ROLE__ = <%- JSON.stringify((typeof user !== 'undefined' && user && user.rol) ? user.rol : '') %>;
    </script>
    <script src="/js/cocina.js"></script>
</body>
</html>


